# 변경 내역

## 주요 개선 사항

### 1. 버그 수정

#### 종료 로직 오류 수정 ✅
- **문제**: 종료 번호 입력 시 `IndexError` 발생 가능
- **해결**: 입력 검증 함수(`get_user_choice`) 추가로 안전한 종료 처리

#### 사용자 입력 검증 강화 ✅
- **문제**: 숫자 외 입력 시 프로그램 크래시
- **해결**: `try/except` 블록으로 모든 입력 보호, 재입력 요구

#### GraphQL 응답 검증 ✅
- **문제**: 네이버 API 오류 시 적절한 처리 없음
- **해결**: `errors` 키 및 `data` 키 존재 여부 확인, 명확한 에러 메시지 제공

### 2. 구조 개선

#### 모듈 분리 구조 채택 ✅
- 기존: 단일 파일 (`main.py`)
- 개선: `backend/` 패키지로 비즈니스 로직 분리
  - `config.py`: 모든 상수 정의
  - `scraper.py`: 스크래핑 로직
  - `utils.py`: 포맷 변환 및 저장
  - `app.py`: FastAPI 애플리케이션

#### 전역 변수 제거 ✅
- 기존: `allKwd`, `headers` 전역 변수 사용
- 개선: 함수 매개변수 및 반환값으로 데이터 전달

#### 하드코딩 제거 ✅
- 기존: URL, sleep 시간, limit 값 하드코딩
- 개선: `config.py`에 상수로 정의

### 3. FastAPI 백엔드 추가

#### REST API 엔드포인트 ✅
- `GET /api/categories`: 카테고리 목록 조회
- `GET /api/keywords`: 키워드 조회 (JSON)
- `GET /api/keywords.txt`: 키워드 조회 (텍스트)

#### CORS 설정 ✅
- 로컬 프론트엔드에서 API 호출 가능
- 개발용 전체 origin 허용

#### 에러 처리 ✅
- 네이버 API 오류: HTTP 502 응답
- 입력 검증 오류: HTTP 422 응답
- 상세한 에러 메시지 제공

### 4. 데이터 활용성 개선

#### 다양한 포맷 지원 ✅
- **TXT**: 키워드명만 (기존 방식)
- **TSV**: 키워드명 + 참여자수
- **CSV**: CSV 형식 (헤더 포함)

#### 추천 키워드 옵션 ✅
- API에서 추천 키워드 포함/미포함 선택 가능
- `includeRecomm=1` 시 추천 키워드를 맨 위에 추가

### 5. CLI 하위 호환성 유지

#### 기존 동작 100% 유지 ✅
- 기본 저장 포맷: TXT (키워드명만)
- 일반 키워드만 저장 (추천 키워드 미포함)
- 파일명: `{카테고리명}.txt`
- 사용자 경험 동일

## 기술적 개선

### 코드 품질
- 모든 함수에 docstring 추가
- 타입 힌트 사용 (`List[Dict]`, `Optional` 등)
- 명확한 예외 처리 및 에러 메시지

### 안정성
- 네트워크 오류 처리
- 입력 검증 강화
- 프로그램 크래시 방지

### 확장성
- 비즈니스 로직과 UI 완전 분리
- FastAPI 백엔드로 웹앱 확장 가능
- 설정 파일로 쉬운 커스터마이징

## 마이그레이션 가이드

### 기존 사용자
- **변경 없음**: CLI 사용 방식 동일 (`python main.py`)
- **추가 설치**: `pip install -r requirements.txt` 필요

### API 사용자
- FastAPI 서버 실행: `uvicorn backend.app:app --reload --port 8000`
- API 문서: `http://localhost:8000/docs`

## 향후 계획

- [ ] 프론트엔드 UI 추가 (선택사항)
- [ ] 키워드 필터링 기능
- [ ] 엑셀 저장 옵션
- [ ] 스케줄링 기능 (자동 수집)
